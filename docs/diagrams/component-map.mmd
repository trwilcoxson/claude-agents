%%{init: {"theme": "base", "themeVariables": {"primaryColor": "#f5f5f5", "primaryTextColor": "#1a1a2e", "primaryBorderColor": "#555", "lineColor": "#4a4a6a", "secondaryColor": "#e8eaf6", "fontSize": "14px", "fontFamily": "'Segoe UI', 'Helvetica Neue', Arial, sans-serif", "edgeLabelBackground": "#ffffffee", "clusterBkg": "#f8f9fa", "clusterBorder": "#dee2e6"}, "flowchart": {"useMaxWidth": false, "htmlLabels": true, "curve": "basis", "padding": 20, "nodeSpacing": 40, "rankSpacing": 50}}}%%

flowchart LR
    subgraph Skill["Skill: threat-model"]
        direction TB
        SKILL["<b>SKILL.md</b><br/>8 phases + orchestration"]

        subgraph RefFiles["references/ — 11 files"]
            direction TB
            FW["<b>frameworks.md</b><br/>STRIDE-LM, PASTA, MITRE,<br/>CWE, OWASP lookups"]
            AOP["<b>agent-output-protocol.md</b><br/>Standardized finding format"]
            RT["<b>report-template.md</b><br/>Sections I-XIV structure"]
            AC["<b>analysis-checklists.md</b><br/>Per-phase completeness"]
            VCC["<b>visual-completeness-checklist.md</b><br/>26 diagram categories"]

            subgraph MermaidRefs["Mermaid Diagram System — 6 files"]
                direction LR
                MS["mermaid-spec.md<br/><i>Symbols, edges, classDefs</i>"]
                ML["mermaid-layers.md<br/><i>4-layer separation</i>"]
                MD["mermaid-diagrams.md<br/><i>Attack trees, auth seq</i>"]
                MT["mermaid-templates.md<br/><i>Starter patterns</i>"]
                MRC["mermaid-review-checklist.md"]
                MC["mermaid-config.json<br/><i>Rendering theme</i>"]
            end
        end
    end

    subgraph Agents["Agent Definitions — ~/.claude/agents/"]
        direction TB
        SA["<b>security-architect.md</b><br/>Type: security-architect<br/>Phases: 1, 3-6, 8s<br/>Skills: threat-model"]
        DS["<b>diagram-specialist.md</b><br/>Type: security-architect<br/>Phases: 2, 7<br/>Skills: threat-model"]
        RA["<b>report-analyst.md</b><br/>Type: report-analyst<br/>Skills: docx, pdf, pptx, frontend-design"]
        CR["<b>code-review-agent.md</b><br/>Type: code-review-agent"]
        PA["<b>privacy-agent.md</b><br/>Type: privacy-agent"]
        GRC["<b>grc-agent.md</b><br/>Type: grc-agent"]
        VS["<b>validation-specialist.md</b><br/><i>No built-in type</i><br/>Spawned as: general-purpose"]
    end

    subgraph Output["Output: threat-model-output/"]
        direction TB
        P["<b>8 Phase Files</b><br/>01-reconnaissance.md<br/>through<br/>08-threat-model-report.md"]
        T["<b>Team Outputs</b><br/>privacy-assessment.md<br/>compliance-gap-analysis.md<br/>code-security-review.md<br/>validation-report.md"]
        R["<b>Report Deliverables</b><br/>report.html<br/>report.docx<br/>report.pdf<br/>executive-summary.pptx"]
    end

    SA -->|"writes 01, 03-06, 08"| P
    DS -->|"writes 02, 07"| P
    PA -->|"writes"| T
    GRC -->|"writes"| T
    CR -->|"writes"| T
    VS -->|"writes"| T
    RA -->|"generates"| R

    SA -.->|"follows"| SKILL
    SA -.->|"consults"| FW
    DS -.->|"consults"| MermaidRefs
    DS -.->|"consults"| VCC
    RA -.->|"follows"| RT
    VS -.->|"verifies against"| FW
    VS -.->|"checks"| AOP

    classDef skill fill:#dbeafe,stroke:#3b82f6,stroke-width:2px,color:#1e3a5f
    classDef ref fill:#fff1f2,stroke:#f43f5e,stroke-width:1px,color:#881337
    classDef mermaid fill:#fce7f3,stroke:#ec4899,stroke-width:1px,color:#831843
    classDef agent fill:#f0fdf4,stroke:#22c55e,stroke-width:1.5px,color:#14532d
    classDef diagram fill:#e0f2fe,stroke:#0284c7,stroke-width:1.5px,color:#0c4a6e
    classDef special fill:#fef3c7,stroke:#f59e0b,stroke-width:1.5px,color:#78350f
    classDef output fill:#f3e8ff,stroke:#a855f7,stroke-width:1.5px,color:#581c87

    class Skill skill
    class RefFiles,FW,AOP,RT,AC,VCC ref
    class MermaidRefs,MS,ML,MD,MT,MRC,MC mermaid
    class SA,RA,CR,PA,GRC agent
    class DS diagram
    class VS special
    class Output,P,T,R output
